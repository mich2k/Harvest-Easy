"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useThemeMode = exports.useTheme = exports.ThemeProvider = exports.ThemeContext = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const window_exists_1 = __importDefault(require("../../helpers/window-exists"));
const default_1 = __importDefault(require("../../theme/default"));
exports.ThemeContext = (0, react_1.createContext)({
    theme: default_1.default,
});
const ThemeProvider = ({ children, value }) => {
    return (0, jsx_runtime_1.jsx)(exports.ThemeContext.Provider, { value: value, children: children });
};
exports.ThemeProvider = ThemeProvider;
function useTheme() {
    return (0, react_1.useContext)(exports.ThemeContext);
}
exports.useTheme = useTheme;
const useThemeMode = (usePreferences) => {
    const [mode, setModeState] = (0, react_1.useState)('light');
    const savePreference = (mode) => localStorage.setItem('theme', mode);
    const getPreference = () => localStorage.getItem('theme') || getPrefersColorScheme();
    const userPreferenceIsDark = () => window.matchMedia?.('(prefers-color-scheme: dark)').matches;
    const getPrefersColorScheme = () => (userPreferenceIsDark() ? 'dark' : 'light');
    const toggleMode = () => {
        const newMode = mode === 'dark' ? 'light' : 'dark';
        setMode(newMode);
        setModeState(newMode);
    };
    const setMode = (mode) => {
        savePreference(mode);
        if (!(0, window_exists_1.default)()) {
            return;
        }
        if (mode === 'dark') {
            document.documentElement.classList.add('dark');
            return;
        }
        document.documentElement.classList.remove('dark');
    };
    if (usePreferences) {
        (0, react_1.useEffect)(() => setModeState(getPreference()), []);
        (0, react_1.useEffect)(() => setMode(mode), [mode]);
    }
    return [mode, setModeState, toggleMode];
};
exports.useThemeMode = useThemeMode;
